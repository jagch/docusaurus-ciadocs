"use strict";(self.webpackChunkdocusaurus_ciadocs=self.webpackChunkdocusaurus_ciadocs||[]).push([[9392],{3905:(e,a,t)=>{t.d(a,{Zo:()=>d,kt:()=>m});var n=t(7294);function r(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function o(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function i(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?o(Object(t),!0).forEach((function(a){r(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function l(e,a){if(null==e)return{};var t,n,r=function(e,a){if(null==e)return{};var t,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)t=o[n],a.indexOf(t)>=0||(r[t]=e[t]);return r}(e,a);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)t=o[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var c=n.createContext({}),s=function(e){var a=n.useContext(c),t=a;return e&&(t="function"==typeof e?e(a):i(i({},a),e)),t},d=function(e){var a=s(e.components);return n.createElement(c.Provider,{value:a},e.children)},p={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},u=n.forwardRef((function(e,a){var t=e.components,r=e.mdxType,o=e.originalType,c=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),u=s(t),m=r,k=u["".concat(c,".").concat(m)]||u[m]||p[m]||o;return t?n.createElement(k,i(i({ref:a},d),{},{components:t})):n.createElement(k,i({ref:a},d))}));function m(e,a){var t=arguments,r=a&&a.mdxType;if("string"==typeof e||r){var o=t.length,i=new Array(o);i[0]=u;var l={};for(var c in a)hasOwnProperty.call(a,c)&&(l[c]=a[c]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var s=2;s<o;s++)i[s]=t[s];return n.createElement.apply(null,i)}return n.createElement.apply(null,t)}u.displayName="MDXCreateElement"},6590:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>c,contentTitle:()=>i,default:()=>p,frontMatter:()=>o,metadata:()=>l,toc:()=>s});var n=t(7462),r=(t(7294),t(3905));const o={},i="Lineamientos y est\xe1ndares para extracci\xf3n de datos",l={unversionedId:"cia-workflow/lineamientos",id:"cia-workflow/lineamientos",title:"Lineamientos y est\xe1ndares para extracci\xf3n de datos",description:"\xcdndice",source:"@site/docs/cia-workflow/lineamientos.md",sourceDirName:"cia-workflow",slug:"/cia-workflow/lineamientos",permalink:"/docusaurus-ciadocs/docs/cia-workflow/lineamientos",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/cia-workflow/lineamientos.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"CIA Workflow DAGs",permalink:"/docusaurus-ciadocs/docs/category/cia-workflow-dags"}},c={},s=[{value:"\xcdndice",id:"\xedndice",level:2},{value:"Introducci\xf3n<div id='intro'/>",id:"introducci\xf3n",level:2},{value:"Lineamientos de extracci\xf3n de datos <div id='li-dev'/>",id:"lineamientos-de-extracci\xf3n-de-datos-",level:2}],d={toc:s};function p(e){let{components:a,...t}=e;return(0,r.kt)("wrapper",(0,n.Z)({},d,t,{components:a,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"lineamientos-y-est\xe1ndares-para-extracci\xf3n-de-datos"},"Lineamientos y est\xe1ndares para extracci\xf3n de datos"),(0,r.kt)("h2",{id:"\xedndice"},"\xcdndice"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#intro"},"Introducci\xf3n")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#li-dev"},"Lineamientos de desarrollo"))),(0,r.kt)("h2",{id:"introducci\xf3n"},"Introducci\xf3n",(0,r.kt)("div",{id:"intro"})),(0,r.kt)("p",null,"Este documento brinda las intrucciones necesarias para realizar un desarrollo de extracci\xf3n de datos de sap utilizando pyrfc."),(0,r.kt)("h2",{id:"lineamientos-de-extracci\xf3n-de-datos-"},"Lineamientos de extracci\xf3n de datos ",(0,r.kt)("div",{id:"li-dev"})),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Cuando un DAG es usado como administrador de contexto, se declara en ella una variable de configuraci\xf3n,\ndonde se especif\xedca la imagen que se va a utilizar. Esta tiene todo lo necesario para realizar la extracci\xf3n de las tablas de sap por pyrfc.\nPor ejemplo la siguiente variable de configuraci\xf3n:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"# Variable globales\nREGISTRY = Variable.get('container-registry-base')\nIMAGE = Variable.get('image-pyrfc-base')\nVERSION = '1.0.19'\n...\nkube_exec_config_special = {\n            \"pod_override\": k8s.V1Pod(\n                spec=k8s.V1PodSpec(\n                    containers=[\n                        k8s.V1Container(\n                            name=\"base\", image=f\"{REGISTRY}/{IMAGE}:{VERSION}\"\n                        ),\n                    ]\n                )\n            )\n        }\n")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"Cuando se crea una tarea, en la configuraci\xf3n del operador se coloca como argumento la variable de configuraci\xf3n.\nComo en el ejemplo siguiente:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"name_task = PythonOperator(\n    task_id='name_task_id',\n    python_callable=name_function_task,\n    executor_config=kube_exec_config_special   # <--\n)\n")),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"En el siguiente ejemplo se muestra la conexi\xf3n y configuraci\xf3n en un task para la extracci\xf3n de datos de SAP.\n",(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("em",{parentName:"strong"},"El delimitador a considerar es siguiente s\xedmbolo: \xc6")))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"# Conexi\xf3n\nsap_rfc_conn = BaseHook.get_connection('rfc_sidex')\nsap_rfc_extra = json.loads(sap_rfc_conn.extra)\nsap_con = Connection(\n    ashost=sap_rfc_conn.host,\n    sysnr=sap_rfc_extra[\"sysnr\"],\n    client=sap_rfc_extra[\"client\"],\n    user=sap_rfc_conn.login,\n    passwd=sap_rfc_conn.password\n)\n\n# Configuraci\xf3n de la tabla a extraer de sap\nresponse = sap_con.call(\n    func_name='ZSD_RFC_READ_TABLE_N',\n    IP_TABLE='TABLA_SAP',\n    IP_DELIMITER='\xc6',\n    IT_FIELDS=[\n        {'FIELDNAME': 'CAMPO_SAP'},\n        {'FIELDNAME': 'CAMPO_SAP'},\n    ],\n)\n\n# Data\ndata = response['ET_DATA'] \n...\n\n")),(0,r.kt)("ol",{start:4},(0,r.kt)("li",{parentName:"ol"},"Manejo de carga y descarga de archivos y sus hist\xf3ricos:",(0,r.kt)("br",null),(0,r.kt)("kbd",null,"![image info](.attachments/file_managment.png)"),(0,r.kt)("br",null))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Importar la librer\xeda de manejo de archivos en el blob storage.\nUtilitario para subir y descargar archivos de datos maestros y extracciones",(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"from cia_airflow.utils.file.blob import ExtractFileManagment\n"))),(0,r.kt)("li",{parentName:"ul"},"Para la utilizaci\xf3n de la librer\xeda es necesario tres argumentos: contrase\xf1a de conexi\xf3n,\nnombre del contenedor, ruta del archivo(se incluye el nombre del archivo).",(0,r.kt)("br",null),(0,r.kt)("kbd",null,"![image info](.attachments/ariflow_container.png)")),(0,r.kt)("li",{parentName:"ul"},"Nombre del Contenedor: (extracts)",(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"path_file = f'dag_id={DAG_ID}/nombre_del_archivo.csv'\n"))),(0,r.kt)("li",{parentName:"ul"},"Ejemplo de ruta del archivo:",(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre"},"path_file = f'dag_id={DAG_ID}/nombre_del_archivo.csv'\n"))),(0,r.kt)("li",{parentName:"ul"},"M\xe9todos de la librer\xeda:")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"M\xe9todo"),(0,r.kt)("th",{parentName:"tr",align:"center"},"Descripci\xf3n"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"create_temporary_file"),(0,r.kt)("td",{parentName:"tr",align:"center"},"Crea un archivo temporal con el nombre enviado previamente.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"create_blob_service_client"),(0,r.kt)("td",{parentName:"tr",align:"center"},"Realiza la conexi\xf3n al blob storage indicado.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"create_historical_file"),(0,r.kt)("td",{parentName:"tr",align:"center"},"Crea el archivo hist\xf3rico. En este caso se coloca la fecha en el final del nombre del archivo.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"upload_blob_historical_file"),(0,r.kt)("td",{parentName:"tr",align:"center"},"Carga del archivo hist\xf3rico al blob storage")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"upload_blob"),(0,r.kt)("td",{parentName:"tr",align:"center"},"Carga del archivo.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"download_file_blob_storage"),(0,r.kt)("td",{parentName:"tr",align:"center"},"Descarga del archivo.")))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Ejemplo:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"        path_file = f'dag_id={DAG_ID}/name_file.csv'\n        blob_storage = ExtractFileManagment(conn.wasb_files.password, BLOBCONTAINER, path_file)\n        path_temp_filename = blob_storage.create_temporary_file()\n        data.to_csv(path_temp_filename, index=False, encoding='utf-8-sig')\n        blob_storage.create_historical_file()\n        blob_storage.create_blob_service_client()\n        blob_storage.upload_blob()\n        blob_storage.upload_blob_historical_file()\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Nomenclatura de archivos de extracci\xf3n:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"Latest: {origen_de_la_tabla}_{nombre_del_task}.{extensi\xf3n}\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Ruta Blob Storage para archivos de extraci\xf3n:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"{Storageaccount}/{container}/dag_id={dag_id}/{archivo de extracci\xf3n}\n")))}p.isMDXComponent=!0}}]);